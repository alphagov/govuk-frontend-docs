<%
wrap_layout :core do
  html = yield

  content_for(:toc_module, "in-page-navigation")

  # For v5 pages, we only want the pages under the `v5` folder
  resources = sitemap.resources.select do |r|
    r.path.start_with?('v5/')
  end

  content_for :sidebar do
    # Because all the pages for `v5` are children of `v5/index.html`,
    # they'd appear as items under the v5 index in the sidebar, which we don't want
    # so we exclude the rendering of child pages for the v5 index page
    v5_index = resources.find{ |r| r.path == 'v5/index.html' }

    with_page_in_navigation(v5_index) do
      without_child_pages_for(v5_index) do
        render_page_tree(resources, current_page, config, html)
      end
    end
  end

  html
end %>
